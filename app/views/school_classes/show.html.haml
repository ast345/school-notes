.page_header
    %h1.page_header_title 時間割
.container
    .class_page_top
        .class_name
            - grade = @school_class.grade.grade_name.gsub('生', '')
            %p.class_name_display= grade + @school_class.class_name

    %table.class_weekly
        %tr
            %th
            - (Date.today.beginning_of_week..Date.today.end_of_week).each do |date|
                - next unless (1..5).include?(date.wday)
                %th  #{date.strftime('%m月%d日')}(#{l(date, format: :abbr_day_name)})
        - (1..6).each do |period|
            %tr
                %td #{period}時間目
                - (Date.today.beginning_of_week..Date.today.end_of_week).each do |date|
                    - next unless (1..5).include?(date.wday)
                    %td
                        .lesson_box{id: "#{period}#{date}"}
                            - lesson = @this_week_lessons.find_by(date: date, period: period)
                            - if lesson
                                - if lesson.grade_subject_unit
                                    - unit_name = lesson.grade_subject_unit.unit_name
                                    - got_unit_id = lesson.grade_subject_unit.id
                                - else
                                    - unit_name = "\b"
                                    - got_unit_id
                                .got_lesson{id: "got_lesson#{period}#{date}", data: {id: "#{period}#{date}", lesson_id: lesson.id, subject_name: lesson.grade_subject.subject.subject_name, grade_subject_id: lesson.grade_subject.id, got_unit_id: got_unit_id}}
                                    %p.lesson_subject{id: "lesson_subject#{period}#{date}"} #{lesson.grade_subject.subject.subject_name}
                                    %p.lesson_unit{id: "lesson_unit#{period}#{date}"} #{unit_name}
                                .edit_lesson_box.hidden{id: "#{period}#{date}"}
                                    = select_tag 'select_subject', options_for_select(@subject_names), id: "select_subject#{period}#{date}", include_blank: true
                                .unit_select_box.hidden{id: "grade_subject_units#{period}#{date}"}
                                .new_unit_box.hidden{id: "#{period}#{date}"}
                                    = text_area_tag :new_unit, '', class: 'new_unit_text', id: "new_unit_name#{period}#{date}"
                                    %p.cancel_btn{id: "#{period}#{date}"} ×
                            - else
                                .new_lesson_btn{id: "#{period}#{date}", data: {id: "#{period}#{date}", date: date, period: period, day_of_week: date.wday}}
                                    %p 新規作成
                                .edit_lesson_box.hidden{id: "#{period}#{date}"}
                                    = select_tag 'select_subject', options_for_select(@subject_names), id: "select_subject#{period}#{date}", include_blank: true
                                .unit_select_box{id: "grade_subject_units#{period}#{date}"}
                                .new_unit_box.hidden{id: "#{period}#{date}"}
                                    = text_area_tag :new_unit, '', class: 'new_unit_text', id: "new_unit_name#{period}#{date}"
                                    %p.cancel_btn{id: "#{period}#{date}"} ×
                                .got_lesson.hidden{id: "got_lesson#{period}#{date}", data: {id: "#{period}#{date}"}}
                                    %p.lesson_subject{id: "lesson_subject#{period}#{date}"}
                                    %p.lesson_unit{id: "lesson_unit#{period}#{date}"}


= javascript_pack_tag 'school_class'